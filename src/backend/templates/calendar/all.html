{% extends "base.html" %}
{% import "macros.html" as macros %}

{% block title %}All Office Days{% endblock %}

{% block content %}
<div class="max-w-screen-xl mx-auto p-4">
    <!-- Header with Navigation -->
    <div class="flex justify-between items-center mb-4">
        <button id="prev-button" class="p-2 rounded hover:bg-gray-200">&lt;</button>
        <h1 class="text-3xl font-semibold">
            {{ current_month_name }} {{ current_year }}
        </h1>
        <button id="next-button" class="p-2 rounded hover:bg-gray-200">&gt;</button>
    </div>

    <!-- Days of the Week -->
    <div class="grid grid-cols-7 gap-2 mb-2 text-center text-gray-600 font-medium">
        {% for day in ['Sunday', 'Monday', 'Tuesday', 'Wednesday', 'Thursday', 'Friday', 'Saturday'] %}
        <div>{{ day }}</div>
        {% endfor %}
    </div>

    <!-- Calendar Grid -->
    <div id="calendar" class="grid grid-cols-7 gap-2">
        {% for day_obj in days %}
        {% set day = day_obj.day_number %}
        {% set day_name = day_obj.day_name %}
        <div class="relative border rounded p-2 
                {% if day_obj.is_weekend %}bg-gray-200{% else %}hover:bg-gray-100{% endif %}"
            data-date="{{ day_obj.date_iso }}">
            <!-- Day Number and Name -->
            <div class="flex flex-col">
                <span class="block text-sm text-gray-700 font-semibold">{{ day }}</span>
                <span class="block text-xs text-gray-500">{{ day_name }}</span>
            </div>
            <!-- Users List -->
            {% if day_obj.users %}
            <ul class="mt-2 text-xs text-blue-600 space-y-1">
                {% for user in day_obj.users[:4] %}
                <li>{{ user }}</li>
                {% endfor %}
                {% if day_obj.users|length > 4 %}
                <li class="extra-users hidden">
                    {% for user in day_obj.users[4:] %}
                    {{ user }}<br>
                    {% endfor %}
                </li>
                <li>
                    <button class="toggle-button text-blue-500 underline text-xs">
                        Show more
                    </button>
                </li>
                {% endif %}
            </ul>
            {% else %}
            <p class="mt-2 text-xs text-gray-400">No Office Days</p>
            {% endif %}
        </div>
        {% endfor %}
    </div>
</div>

<!-- Optional: JavaScript for Expand/Collapse Functionality -->
<script>
    document.addEventListener('DOMContentLoaded', function () {
        const toggleButtons = document.querySelectorAll('.toggle-button');

        toggleButtons.forEach(button => {
            button.addEventListener('click', function (e) {
                const parentLi = e.target.parentElement;
                const extraUsers = parentLi.previousElementSibling;

                if (extraUsers.classList.contains('hidden')) {
                    extraUsers.classList.remove('hidden');
                    e.target.textContent = 'Show less';
                } else {
                    extraUsers.classList.add('hidden');
                    e.target.textContent = 'Show more';
                }
            });
        });

        // Navigation Buttons
        document.getElementById('prev-button').addEventListener('click', function () {
            let currentYear = parseInt("{{ current_year }}");
            let currentMonth = parseInt("{{ current_month }}") - 1;
            if (currentMonth < 1) {
                currentMonth = 12;
                currentYear -= 1;
            }
            window.location.href = `/calendar?year=${currentYear}&month=${currentMonth}`;
        });

        document.getElementById('next-button').addEventListener('click', function () {
            let currentYear = parseInt("{{ current_year }}");
            let currentMonth = parseInt("{{ current_month }}") + 1;
            if (currentMonth > 12) {
                currentMonth = 1;
                currentYear += 1;
            }
            window.location.href = `/calendar?year=${currentYear}&month=${currentMonth}`;
        });
    });
</script>
{% endblock %}
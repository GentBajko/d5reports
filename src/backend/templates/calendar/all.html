{% extends "base.html" %}
{% import "macros.html" as macros %}

{% block title %}All Office Days{% endblock %}

{% block content %}
<div class="max-w-screen-xl mx-auto p-4">
    <!-- Header with Navigation -->
    <div class="flex justify-between items-center mb-4">
        <button id="prev-button" class="p-2 rounded hover:bg-gray-200">&lt;</button>
        <h1 class="text-3xl font-semibold">
            {{ current_month_name }} {{ current_year }}
        </h1>
        <button id="next-button" class="p-2 rounded hover:bg-gray-200">&gt;</button>
    </div>

    <!-- XLSX Upload Form -->
    <form action="/calendar/upload_xlsx" method="post" enctype="multipart/form-data" class="mb-6">
        <label for="file" class="block mb-2 text-sm font-medium text-gray-700">Upload XLS/XLSX</label>
        <input id="file" name="file" type="file" accept=".xlsx,.xls" required
            class="block w-full text-sm text-gray-900 border border-gray-300 rounded-lg cursor-pointer focus:ring-blue-500 focus:border-blue-500">
        <button type="submit" class="mt-2 px-4 py-2 bg-blue-600 text-white rounded hover:bg-blue-700 text-sm">
            Upload
        </button>
    </form>

    <!-- Days of the Week -->
    <div class="grid grid-cols-7 gap-2 mb-2 text-center text-gray-600 font-medium">
        {% for day in ['Sunday', 'Monday', 'Tuesday', 'Wednesday', 'Thursday', 'Friday', 'Saturday'] %}
        <div>{{ day }}</div>
        {% endfor %}
    </div>

    <!-- Calendar Grid -->
    <div id="calendar" class="grid grid-cols-7 gap-2">
        {% for day_obj in days %}
        {% set day = day_obj.day_number %}
        {% set day_name = day_obj.day_name %}
        <div class="relative border rounded p-2 
                {% if day_obj.is_weekend %}bg-gray-200{% else %}hover:bg-gray-100{% endif %}"
            data-date="{{ day_obj.date_iso }}">
            <!-- Day Number and Name -->
            <div class="flex flex-col">
                <span class="block text-sm text-gray-700 font-semibold">{{ day }}</span>
                <span class="block text-xs text-gray-500">{{ day_name }}</span>
            </div>
            <!-- Users List -->
            {% if day_obj.users %}
            <ul class="mt-2 text-xs space-y-1">
                {% for user_item in day_obj.users %}
                <li class="{{ user_item.color_class }}">{{ user_item.name }}</li>
                {% endfor %}
            </ul>
            {% else %}
            <p class="mt-2 text-xs text-gray-400">No Office Days</p>
            {% endif %}
        </div>
        {% endfor %}
    </div>
</div>

<!-- JavaScript for Navigation -->
<script>
    document.addEventListener('DOMContentLoaded', function () {
        // Navigation Buttons
        document.getElementById('prev-button').addEventListener('click', function () {
            let currentYear = parseInt("{{ current_year }}");
            let currentMonth = parseInt("{{ current_month }}") - 1;
            if (currentMonth < 1) {
                currentMonth = 12;
                currentYear -= 1;
            }
            window.location.href = `/calendar?year=${currentYear}&month=${currentMonth}`;
        });

        document.getElementById('next-button').addEventListener('click', function () {
            let currentYear = parseInt("{{ current_year }}");
            let currentMonth = parseInt("{{ current_month }}") + 1;
            if (currentMonth > 12) {
                currentMonth = 1;
                currentYear += 1;
            }
            window.location.href = `/calendar?year=${currentYear}&month=${currentMonth}`;
        });
    });
</script>
{% endblock %}